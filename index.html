<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kickcoins - Fantasy Betting</title>
<style>
body { font-family: Arial, sans-serif; background-color: #121212; color: #fff; margin:0; padding:0; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background-color:#1a1a1a; }
header .account { display:flex; align-items:center; gap:15px; }
.tabs { display:flex; background-color:#1a1a1a; }
.tab { flex:1; padding:10px; text-align:center; cursor:pointer; border-bottom:2px solid #121212; }
.tab.active { border-bottom:2px solid #00ff00; }
main { padding:20px; }
.card { background-color:#1f1f1f; padding:15px; margin:10px 0; border-radius:8px; }
.prop { display:flex; justify-content:space-between; align-items:center; margin:10px 0; }
.prop input[type="number"] { width:50px; margin-left:10px; }
select { padding:5px; }
button { padding:5px 10px; cursor:pointer; border:none; border-radius:5px; }
button:disabled { background-color: #555; cursor: not-allowed; }
.green { color:#00ff00; }
.red { color:#ff0000; }
table { width:100%; border-collapse:collapse; }
th, td { padding:8px; text-align:left; border-bottom:1px solid #333; }
#login-card { max-width:400px; margin:50px auto; }
.bet-payout { margin-left:10px; font-weight:bold; }
</style>
</head>
<body>

<header>
<h1>Kickcoins ⚽</h1>
<div class="account" id="account-info"></div>
<button id="logout-btn" style="display:none;">Logout</button>
</header>

<div id="login-card" class="card">
<h2>Login / Create Account</h2>
<label>Username:</label><input type="text" id="login-username"><br><br>
<label>Password:</label><input type="password" id="login-password"><br><br>
<button id="login-btn">Login</button>
<button id="create-btn">Create Account</button>
</div>

<div id="app" style="display:none;">
<div class="tabs">
    <div class="tab active" data-tab="vote">MVP Voting</div>
    <div class="tab" data-tab="bet">Betting</div>
    <div class="tab" data-tab="leaderboard">Leaderboards</div>
    <div class="tab" data-tab="history">Bet History</div>
    <div class="tab" data-tab="admin">Admin</div>
</div>

<main>
<div class="tab-content" id="vote-tab">
    <div class="card">
        <h2>Vote for MVP</h2>
        <label>1st Place:</label>
        <select id="vote1"></select>
        <label>2nd Place:</label>
        <select id="vote2"></select>
        <label>3rd Place:</label>
        <select id="vote3"></select>
        <button id="submit-votes">Submit Votes</button>
    </div>
</div>

<div class="tab-content" id="bet-tab" style="display:none;">
    <div class="card">
        <h2>Betting</h2>
        <div id="balance-display"></div>
        <label>Select Player:</label>
        <select id="player-select"></select>
        <div id="props-container"></div>
        <div>Total Potential Payout: <span id="total-payout" class="bet-payout">0</span></div>
        <button id="submit-bets">Place Bets</button>
    </div>
</div>

<div class="tab-content" id="leaderboard-tab" style="display:none;">
    <div class="card">
        <h2>Overall MVP Leaderboard</h2>
        <table id="mvp-leaderboard">
            <thead><tr><th>Place</th><th>Player</th><th>Points</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="card">
        <h2>MVP History per Match</h2>
        <div id="mvp-history"></div>
    </div>
</div>

<div class="tab-content" id="history-tab" style="display:none;">
    <div class="card">
        <h2>Betting Leaderboard</h2>
        <table id="coin-leaderboard">
            <thead><tr><th>Place</th><th>Player</th><th>Coins</th><th>Admin</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="card" id="history-container"></div>
</div>

<div class="tab-content" id="admin-tab" style="display:none;">
    <div class="card">
        <h2>Admin Controls</h2>
        <button id="open-bets">Open Betting</button>
        <button id="close-bets" disabled>Close Betting</button>
        <button id="start-match" disabled>Start Match</button>
        <button id="end-match" disabled>End Match</button>
        <div id="resolve-bets"></div>
    </div>
    <div class="card">
        <h2>Manage Betting Props</h2>
        <label>Player:</label>
        <select id="prop-player"></select><br><br>
        <input type="text" id="new-prop" placeholder="Enter prop name">
        <input type="number" id="new-odds" placeholder="Odds (x)" min="1">
        <button id="add-prop">Add Prop</button>
        <div id="props-list"></div>
    </div>
    <div class="card">
        <h2>Admin Tests</h2>
        <button id="clear-votes">Clear Mvp Votes</button>
    </div>
</div>
</main>

<script>
// ------------------ STORAGE ------------------
if(!localStorage.getItem('kickcoinsUsers')){
    var users = {
        "Erick": { password:"pass", totalCoins:100, availableCoins:0, votesThisMatch:{}, bets:[], mvpPoints:0, history:[], voted:false },
        "Yansy": { password:"pass", totalCoins:100, availableCoins:0, votesThisMatch:{}, bets:[], mvpPoints:0, history:[], voted:false },
        "admin": { password:"KickCoins123", isAdmin:true, totalCoins:0, availableCoins:0, votesThisMatch:{}, bets:[], mvpPoints:0, history:[], voted:false }
    };
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
}else{
    var users = JSON.parse(localStorage.getItem('kickcoinsUsers'));
}

const players = ["Erick","Yansy","Bernie","Erubial","Samir","Angel","Abel","Estress","Alan","Ace"];
let mvpScores = localStorage.getItem('mvpScores') ? JSON.parse(localStorage.getItem('mvpScores')) : {};
players.forEach(p=>{ if(!mvpScores[p]) mvpScores[p]=0; });

let propsTemplate = localStorage.getItem('propsTemplate') ? JSON.parse(localStorage.getItem('propsTemplate')) : {};
players.forEach(p=>{
    if(!propsTemplate[p]) propsTemplate[p] = [{name:"Score", odds:4},{name:"Assist", odds:3},{name:"Anything", odds:2}];
});
localStorage.setItem('propsTemplate', JSON.stringify(propsTemplate));

let mvpHistory = localStorage.getItem('mvpHistory') ? JSON.parse(localStorage.getItem('mvpHistory')) : [];
let currentMatch = localStorage.getItem('currentMatch') ? parseInt(localStorage.getItem('currentMatch')) : 0;

let currentUser=null;
let matchActive=false;
let bettingOpen=false;

// ------------------ LOGIN ------------------
function showLogin(show=true){
    document.getElementById('login-card').style.display=show?'block':'none';
    document.getElementById('app').style.display=!show?'block':'none';
    document.getElementById('logout-btn').style.display=!show?'inline':'none';
}
document.getElementById('login-btn').addEventListener('click',()=>{
    const user=document.getElementById('login-username').value;
    const pass=document.getElementById('login-password').value;
    if(users[user] && users[user].password===pass){
        currentUser=user; showLogin(false); updateUI(); populateVoting(); populatePlayers(); updateLeaderboards(); updateHistory(); populatePropAdmin();
        alert("Logged in!");
    }else{ alert("Invalid credentials"); }
});
document.getElementById('create-btn').addEventListener('click',()=>{
    const user=document.getElementById('login-username').value;
    const pass=document.getElementById('login-password').value;
    if(users[user]){ alert("User exists"); return; }
    users[user]={password:pass,totalCoins:100,availableCoins:0,votesThisMatch:{}, bets:[], mvpPoints:0, history:[], voted:false};
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
    alert("Account created! You can now login.");
});
document.getElementById('logout-btn').addEventListener('click',()=>{ currentUser=null; showLogin(true); });

// ------------------ TAB NAV ------------------
document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(tc=>tc.style.display='none');
        document.getElementById(tab.dataset.tab+'-tab').style.display='block';
        updateUI(); if(tab.dataset.tab==="history") updateHistory();
        if(tab.dataset.tab==="admin" && currentUser && users[currentUser].isAdmin) renderPropsList();
    });
});

// ------------------ ACCOUNT DISPLAY ------------------
function updateUI(){
    if(!currentUser) return;
    let acc=users[currentUser];
    document.getElementById('account-info').innerHTML=`${currentUser} | Total: ${acc.totalCoins} 💰 | Available: ${acc.availableCoins} 💸`;
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
    const adminTab = document.querySelector('.tab[data-tab="admin"]');
    const adminContent = document.getElementById('admin-tab');
    if(users[currentUser].isAdmin){
        adminTab.style.display = "block";
    }else{
        adminTab.style.display = "none"; adminContent.style.display = "none";
        if(document.querySelector(".tab.active").dataset.tab === "admin"){
            document.querySelector('.tab[data-tab="vote"]').click();
        }
    }
}

// ------------------ MVP VOTING ------------------
function populateVoting(){
    ["vote1","vote2","vote3"].forEach(id=>{
        let sel=document.getElementById(id); sel.innerHTML="";
        players.forEach(p=>{
            let opt=document.createElement("option"); opt.value=p; opt.text=p; sel.appendChild(opt);
        });
    });
}
document.getElementById('submit-votes').addEventListener('click',()=>{
    if(!matchActive){ alert("Match not started yet."); return; }
    if(users[currentUser].voted){ alert("Already voted."); return; }
    let first=document.getElementById('vote1').value;
    let second=document.getElementById('vote2').value;
    let third=document.getElementById('vote3').value;
    if(new Set([first,second,third]).size<3){ alert("Cannot vote same player multiple times."); return; }
    users[currentUser].votesThisMatch={"1st":first,"2nd":second,"3rd":third};
    users[currentUser].voted=true;
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
    alert("Votes submitted!");
    updateLeaderboards();
});

// ------------------ BETTING ------------------
function populatePlayers(){
    let sel=document.getElementById('player-select'); sel.innerHTML="";
    players.forEach(p=>{
        let opt=document.createElement("option"); opt.value=p; opt.text=p; sel.appendChild(opt);
    });
    sel.addEventListener('change', populateProps);
}
function populateProps(){
    let container=document.getElementById('props-container'); container.innerHTML="";
    let player=document.getElementById('player-select').value;
    propsTemplate[player].forEach(prop=>{
        let card=document.createElement("div"); card.className="prop";
        let label=document.createElement("span"); label.textContent=`${prop.name} (${prop.odds}x)`; label.className="green";
        let input=document.createElement("input"); input.type="number"; input.min=0; input.max=users[currentUser].availableCoins; input.dataset.odds=prop.odds;
        input.oninput=updatePotentialPayout;
        card.appendChild(label); card.appendChild(input); container.appendChild(card);
    });
    updatePotentialPayout();
}
function updatePotentialPayout(){
    const container=document.getElementById('props-container');
    let total=0;
    for(let p of container.children){
        let input=p.querySelector('input'); let amt=Number(input.value); let odds=Number(input.dataset.odds);
        if(amt>0){ total += amt*odds + amt; }
    }
    const payoutDisplay=document.getElementById('total-payout');
    payoutDisplay.textContent=total; payoutDisplay.style.color=total>50?'green':'yellow';
}
document.getElementById('submit-bets').addEventListener('click',()=>{
    if(!bettingOpen){ alert("Betting not open."); return; }
    let container=document.getElementById('props-container'); let acc=users[currentUser];
    for(let p of container.children){
        let propName=p.querySelector('span').textContent;
        let amt=Number(p.querySelector('input').value);
        let odds=Number(p.querySelector('input').dataset.odds);
        if(amt>0){
            let betAmount = Math.min(amt, acc.availableCoins);
            if(betAmount > 0){
                acc.availableCoins -= betAmount;
                acc.bets.push({match:currentMatch, player:document.getElementById('player-select').value,prop:propName,amount:betAmount,odds:odds,resolved:false,won:false});
            } else { alert("Cannot bet more than available balance"); }
        }
    }
    updateUI(); updatePotentialPayout(); updateHistory(); alert("Bets placed!");
});

// ------------------ ADMIN BET CONTROL ------------------
document.getElementById('open-bets').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    bettingOpen=true; document.getElementById('open-bets').disabled=true; document.getElementById('close-bets').disabled=false;
    currentMatch+=1; localStorage.setItem('currentMatch', currentMatch);
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            let give=10;
            if(users[u].totalCoins >= give){
                users[u].totalCoins -= give;
                users[u].availableCoins = give;
            } else {
                users[u].availableCoins = users[u].totalCoins;
                users[u].totalCoins = 0;
            }
            users[u].voted=false;
        }
    });
    updateUI();
});
document.getElementById('close-bets').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    bettingOpen=false; document.getElementById('open-bets').disabled=false; document.getElementById('close-bets').disabled=true;
    document.getElementById('start-match').disabled=false;
    Object.keys(users).forEach(u=>{ if(!users[u].isAdmin) users[u].availableCoins=0; });
    updateUI(); updateHistory();
});
document.getElementById('start-match').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    matchActive=true; document.getElementById('start-match').disabled=true; document.getElementById('end-match').disabled=false;
    updateUI(); reviewBetsForAdmin();
});
document.getElementById('end-match').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    matchActive=false; document.getElementById('end-match').disabled=true; document.getElementById('start-match').disabled=false;
    let matchResult={match:currentMatch, results:[]};
    Object.keys(users).forEach(u=>{
        let v=users[u].votesThisMatch;
        if(v["1st"]) { mvpScores[v["1st"]]+=5; matchResult.results.push({player:v["1st"],points:5,place:"1st"}); }
        if(v["2nd"]) { mvpScores[v["2nd"]]+=3; matchResult.results.push({player:v["2nd"],points:3,place:"2nd"}); }
        if(v["3rd"]) { mvpScores[v["3rd"]]+=2; matchResult.results.push({player:v["3rd"],points:2,place:"3rd"}); }
        users[u].votesThisMatch={}; users[u].voted=false;
    });
    mvpHistory.push(matchResult);
    localStorage.setItem('mvpScores', JSON.stringify(mvpScores));
    localStorage.setItem('mvpHistory', JSON.stringify(mvpHistory));
    updateLeaderboards(); updateUI(); alert("Match ended, MVP tallied!");
});

// ------------------ REVIEW & RESOLVE BETS ------------------
function reviewBetsForAdmin(){
    const resolveDiv = document.getElementById('resolve-bets');
    resolveDiv.innerHTML="<h3>Resolve Bets</h3>";
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            users[u].bets.filter(b=>!b.resolved).forEach(bet=>{
                const div=document.createElement('div');
                div.innerHTML=`${u}: ${bet.player} - ${bet.prop} | Amount: ${bet.amount} | Odds: ${bet.odds}x `;
                const winBtn=document.createElement('button'); winBtn.textContent="Win";
                const loseBtn=document.createElement('button'); loseBtn.textContent="Lose";
                winBtn.onclick=()=>{ resolveBet(u, bet, true); div.remove(); };
                loseBtn.onclick=()=>{ resolveBet(u, bet, false); div.remove(); };
                div.appendChild(winBtn); div.appendChild(loseBtn);
                resolveDiv.appendChild(div);
            });
        }
    });
}
function resolveBet(username, bet, won){
    bet.resolved=true;
    bet.won=won;
    if(won){
        let payout = bet.amount * bet.odds + bet.amount;
        users[username].totalCoins += payout;
    }
    users[username].availableCoins -= bet.amount;
    updateUI(); updateHistory(); updateLeaderboards();
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
}

// ------------------ LEADERBOARDS ------------------
function updateLeaderboards(){
    let tbody=document.getElementById('mvp-leaderboard').querySelector('tbody'); tbody.innerHTML="";
    Object.entries(mvpScores).sort((a,b)=>b[1]-a[1]).forEach((entry,i)=>{
        let tr=document.createElement("tr");
        let icon=i===0?'🥇':i===1?'🥈':i===2?'🥉':i<7?'🪨':'🍆';
        tr.innerHTML=`<td>${i+1} ${icon}</td><td>${entry[0]}</td><td>${entry[1]}</td>`; tbody.appendChild(tr);
    });
    const mh=document.getElementById('mvp-history'); mh.innerHTML="";
    mvpHistory.forEach(m=>{
        let div=document.createElement("div"); div.className="card";
        div.innerHTML=`<strong>Match ${m.match}</strong><br>`+m.results.map(r=>`${r.place}: ${r.player} (+${r.points})`).join("<br>");
        mh.appendChild(div);
    });
    let ct=document.getElementById('coin-leaderboard').querySelector('tbody'); ct.innerHTML="";
    Object.entries(users).filter(u=>!users[u[0]].isAdmin).sort((a,b)=>b[1].totalCoins-a[1].totalCoins).forEach((entry,i)=>{
        let tr=document.createElement("tr");
        let delBtn=users[currentUser]&&users[currentUser].isAdmin?`<button onclick="deleteUser('${entry[0]}')">Delete</button>`:"";
        let icon=i===0?'🥇':i===1?'🥈':i===2?'🥉':i<7?'🪨':'🍆';
        tr.innerHTML=`<td>${i+1} ${icon}</td><td>${entry[0]}</td><td>${entry[1].totalCoins}</td><td>${delBtn}</td>`; ct.appendChild(tr);
    });
}

// ------------------ HISTORY ------------------
function updateHistory(){
    const container=document.getElementById('history-container'); container.innerHTML="";
    if(!currentUser) return;
    users[currentUser].bets.filter(b=>b.match===currentMatch).forEach(bet=>{
        let div=document.createElement("div"); div.className="card";
        div.innerHTML=`Match ${bet.match} | Bet: ${bet.player} - ${bet.prop} | Amount: ${bet.amount} | Odds: ${bet.odds}x | Resolved: ${bet.resolved} | Won: ${bet.won}`;
        container.appendChild(div);
    });
}

// ------------------ ADMIN PROP MANAGEMENT ------------------
function populatePropAdmin(){
    let sel=document.getElementById('prop-player'); sel.innerHTML="";
    players.forEach(p=>{ let opt=document.createElement("option"); opt.value=p; opt.text=p; sel.appendChild(opt); });
    renderPropsList();
}
function renderPropsList(){
    let player=document.getElementById('prop-player').value;
    let container=document.getElementById('props-list'); container.innerHTML="";
    propsTemplate[player].forEach((prop,index)=>{
        let div=document.createElement("div"); div.textContent=`${prop.name} (${prop.odds}x) `;
        let btn=document.createElement("button"); btn.textContent="Remove"; btn.onclick=()=>{
            propsTemplate[player].splice(index,1);
            localStorage.setItem('propsTemplate', JSON.stringify(propsTemplate));
            renderPropsList();
        };
        div.appendChild(btn); container.appendChild(div);
    });
}
document.getElementById('add-prop').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    let player=document.getElementById('prop-player').value;
    let name=document.getElementById('new-prop').value.trim();
    let odds=parseInt(document.getElementById('new-odds').value);
    if(name && odds>0){
        propsTemplate[player].push({name,odds});
        localStorage.setItem('propsTemplate', JSON.stringify(propsTemplate));
        document.getElementById('new-prop').value=""; document.getElementById('new-odds').value="";
        renderPropsList();
    }
});

// ------------------ DELETE USER ------------------
function deleteUser(username){
    if(!currentUser || !users[currentUser].isAdmin) return;
    if(confirm(`Admin, confirm delete ${username}?`)){ delete users[username]; updateLeaderboards(); updateUI(); alert(`${username} deleted`); }
}

// ------------------ CLEAR VOTES ------------------
document.getElementById('clear-votes').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin) return;
    Object.keys(users).forEach(u=>users[u].votesThisMatch={});
    mvpScores={}; mvpHistory=[]; currentMatch=0;
    localStorage.setItem('kickcoinsUsers', JSON.stringify(users));
    localStorage.removeItem('mvpScores'); localStorage.removeItem('mvpHistory'); localStorage.setItem('currentMatch', currentMatch);
    updateLeaderboards(); updateUI(); alert("Votes cleared.");
});
</script>
</body>
</html>
