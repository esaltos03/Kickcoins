<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edge Book</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0a0f0f; color: #fff; text-align: center; }
    .hidden { display: none; }
    .container { max-width: 700px; margin: auto; padding: 20px; }
    input, button, select { margin: 5px; padding: 8px; }
    .balance-box { background: #111; padding: 10px; margin: 10px 0; border-radius: 8px; }
    .leaderboard, .mvp-board { background: #111; padding: 10px; border-radius: 8px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Edge Book</h1>

    <!-- Login/Register -->
    <div id="authSection">
      <h2>Login / Register</h2>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <br>
      <button onclick="login()">Login</button>
      <button onclick="register()">Register</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
      <h2 id="welcome"></h2>
      <button onclick="logout()">Logout</button>
      <div class="balance-box">
        <p id="totalBalance"></p>
        <p id="availableBalance"></p>
      </div>

      <!-- Admin Controls -->
      <div id="adminPanel" class="hidden">
        <h3>Admin Panel</h3>
        <button id="startMatchBtn" onclick="startMatch()">Start Match</button>
        <button id="endMatchBtn" onclick="endMatch()" disabled>End Match</button>
        <div id="resolveSection"></div>
      </div>

      <!-- Betting -->
      <div id="bettingSection" class="hidden">
        <h3>Place Bets</h3>
        <select id="betOption">
          <option value="Erick">Erick to Score</option>
          <option value="Yansy">Yansy to Score</option>
          <option value="Bernie">Bernie to Score</option>
        </select>
        <input type="number" id="betAmount" placeholder="Amount" min="1" max="10">
        <button onclick="placeBet()">Bet</button>
        <div id="betList"></div>
      </div>

      <!-- MVP Voting -->
      <div id="mvpSection" class="hidden">
        <h3>MVP Voting</h3>
        <select id="mvp1"></select>
        <select id="mvp2"></select>
        <select id="mvp3"></select>
        <button onclick="submitVote()">Submit Vote</button>
        <p id="voteMsg"></p>
      </div>

      <!-- Leaderboards -->
      <div class="leaderboard">
        <h3>Coin Leaderboard</h3>
        <ul id="coinBoard"></ul>
      </div>
      <div class="mvp-board">
        <h3>MVP Leaderboard</h3>
        <ul id="mvpBoard"></ul>
      </div>
    </div>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users")) || {};
    let currentUser = null;
    let matchActive = false;
    let mvpVotes = {};

    const adminCreds = { username: "admin", password: "edgebook2025" };

    function saveUsers() { localStorage.setItem("users", JSON.stringify(users)); }

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (u === adminCreds.username && p === adminCreds.password) {
        currentUser = u;
        showDashboard(true);
        return;
      }
      if (users[u] && users[u].password === p) {
        currentUser = u;
        showDashboard(false);
      } else alert("Invalid credentials");
    }

    function register() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (users[u]) return alert("User exists");
      users[u] = { password: p, total: 100, available: 0 };
      saveUsers();
      alert("Registered. Please login.");
    }

    function logout() {
      currentUser = null;
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("authSection").classList.remove("hidden");
    }

    function showDashboard(isAdmin) {
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("welcome").innerText = "Welcome " + currentUser;
      document.getElementById("adminPanel").classList.toggle("hidden", !isAdmin);
      updateBalances();
      updateLeaderboards();
    }

    function updateBalances() {
      if (currentUser !== "admin") {
        const u = users[currentUser];
        document.getElementById("totalBalance").innerText = "Total Balance: " + u.total;
        document.getElementById("availableBalance").innerText = "Available: " + u.available;
      }
    }

    function startMatch() {
      if (matchActive) return;
      matchActive = true;
      document.getElementById("startMatchBtn").disabled = true;
      document.getElementById("endMatchBtn").disabled = false;
      document.getElementById("bettingSection").classList.remove("hidden");
      document.getElementById("mvpSection").classList.remove("hidden");
      for (let u in users) { users[u].available = 10; }
      saveUsers();
      updateBalances();
    }

    function endMatch() {
      if (!matchActive) return;
      matchActive = false;
      document.getElementById("startMatchBtn").disabled = false;
      document.getElementById("endMatchBtn").disabled = true;
      document.getElementById("bettingSection").classList.add("hidden");
      document.getElementById("mvpSection").classList.add("hidden");
      updateLeaderboards();
      mvpVotes = {};
      saveUsers();
    }

    function placeBet() {
      if (!matchActive) return alert("Match not active");
      const amt = parseInt(document.getElementById("betAmount").value);
      const u = users[currentUser];
      if (amt > u.available) return alert("Not enough available");
      u.available -= amt;
      saveUsers();
      updateBalances();
      document.getElementById("betList").innerText += currentUser + " bet " + amt + " on " + document.getElementById("betOption").value + "\n";
    }

    function submitVote() {
      if (!matchActive) return;
      const p1 = document.getElementById("mvp1").value;
      const p2 = document.getElementById("mvp2").value;
      const p3 = document.getElementById("mvp3").value;
      if (new Set([p1, p2, p3]).size < 3) return alert("Cannot vote same player twice");
      if (mvpVotes[currentUser]) return alert("Already voted");
      mvpVotes[currentUser] = {1:p1,2:p2,3:p3};
      tallyMVP();
      document.getElementById("voteMsg").innerText = "Thanks for voting!";
    }

    function tallyMVP() {
      let scores = {};
      for (let v in mvpVotes) {
        let pick = mvpVotes[v];
        scores[pick[1]] = (scores[pick[1]]||0)+5;
        scores[pick[2]] = (scores[pick[2]]||0)+3;
        scores[pick[3]] = (scores[pick[3]]||0)+2;
      }
      let sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      document.getElementById("mvpBoard").innerHTML = sorted.map(s=>"<li>"+s[0]+": "+s[1]+"</li>").join("");
    }

    function updateLeaderboards() {
      let sorted = Object.entries(users).sort((a,b)=>b[1].total - a[1].total);
      document.getElementById("coinBoard").innerHTML = sorted.map(s=>"<li>"+s[0]+": "+s[1].total+"</li>").join("");
    }

    // Populate MVP dropdowns
    window.onload = () => {
      ["mvp1","mvp2","mvp3"].forEach(id=>{
        let sel=document.getElementById(id);
        ["Erick","Yansy","Bernie"].forEach(p=>{
          let o=document.createElement("option"); o.value=p; o.text=p; sel.add(o);
        });
      });
    }
  </script>
</body>
</html>
