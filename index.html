<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kickcoins - Fantasy Betting</title>
<style>
body { font-family: Arial, sans-serif; background-color: #121212; color: #fff; margin:0; padding:0; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background-color:#1a1a1a; }
header .account { display:flex; align-items:center; gap:15px; }
.tabs { display:flex; background-color:#1a1a1a; }
.tab { flex:1; padding:10px; text-align:center; cursor:pointer; border-bottom:2px solid #121212; }
.tab.active { border-bottom:2px solid #00ff00; }
main { padding:20px; }
.card { background-color:#1f1f1f; padding:15px; margin:10px 0; border-radius:8px; }
.prop { display:flex; justify-content:space-between; align-items:center; margin:10px 0; }
.prop input[type="number"] { width:50px; margin-left:10px; }
select { padding:5px; }
button { padding:5px 10px; cursor:pointer; border:none; border-radius:5px; }
.green { color:#00ff00; }
.red { color:#ff0000; }
.medal { font-size:1.2em; margin-left:5px; }
table { width:100%; border-collapse:collapse; }
th, td { padding:8px; text-align:left; border-bottom:1px solid #333; }
#login-card { max-width:400px; margin:50px auto; }
.bet-history-box { border:1px solid #333; padding:5px; margin-bottom:5px; }
</style>
</head>
<body>

<header>
<h1>Kickcoins ‚öΩ</h1>
<div class="account" id="account-info"></div>
<button id="logout-btn" style="display:none;">Logout</button>
</header>

<div id="login-card" class="card">
<h2>Login / Create Account</h2>
<label>Username:</label><input type="text" id="login-username"><br><br>
<label>Password:</label><input type="password" id="login-password"><br><br>
<button id="login-btn">Login</button>
<button id="create-btn">Create Account</button>
</div>

<div id="app" style="display:none;">
<div class="tabs">
    <div class="tab active" data-tab="vote">MVP Voting</div>
    <div class="tab" data-tab="bet">Betting</div>
    <div class="tab" data-tab="leaderboard">Leaderboards</div>
    <div class="tab" data-tab="admin">Admin</div>
</div>

<main>
<!-- MVP Voting -->
<div class="tab-content" id="vote-tab">
    <div class="card">
        <h2>Vote for MVP</h2>
        <label>1st Place:</label>
        <select id="vote1"></select>
        <label>2nd Place:</label>
        <select id="vote2"></select>
        <label>3rd Place:</label>
        <select id="vote3"></select>
        <button id="submit-votes">Submit Votes</button>
    </div>
</div>

<!-- Betting -->
<div class="tab-content" id="bet-tab" style="display:none;">
    <div class="card">
        <h2>Betting</h2>
        <div id="balance-display"></div>
        <label>Select Player:</label>
        <select id="player-select"></select>
        <div id="props-container"></div>
        <div id="payout-preview">Potential Payout: 0</div>
        <button id="submit-bets">Place Bets</button>
    </div>
    <div class="card">
        <h2>Bet History</h2>
        <div id="bet-history-container"></div>
    </div>
</div>

<!-- Leaderboards -->
<div class="tab-content" id="leaderboard-tab" style="display:none;">
    <div class="card">
        <h2>MVP Leaderboard</h2>
        <table id="mvp-leaderboard">
            <thead><tr><th>Place</th><th>Player</th><th>Points</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="card">
        <h2>Coin Leaderboard</h2>
        <table id="coin-leaderboard">
            <thead><tr><th>Place</th><th>Player</th><th>Coins</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Admin -->
<div class="tab-content" id="admin-tab" style="display:none;">
    <div class="card">
        <h2>Admin Controls</h2>
        <button id="start-match">Start Match</button>
        <button id="end-match">End Match</button>
        <div id="resolve-bets"></div>
        <h3>Remove Users</h3>
        <div id="admin-user-list"></div>
    </div>
</div>
</main>
</div>

<script>
/* ----- SAMPLE DATA ----- */
const players = ["Erick","Yansy","Bernie","Erubial","Samir","Angel","Abel","Estress","Alan","Ace"];
const propsTemplate = ["Assist","Score","Anything"];
let users = JSON.parse(localStorage.getItem("kickcoins_users")) || {
    "Erick": { password:"pass", totalCoins:100, availableCoins:0, votes:{}, bets:[], mvpPoints:0, betHistory:[] },
    "Yansy": { password:"pass", totalCoins:100, availableCoins:0, votes:{}, bets:[], mvpPoints:0, betHistory:[] },
    "admin": { password:"KickCoins123", isAdmin:true, totalCoins:0, availableCoins:0, votes:{}, bets:[], mvpPoints:0, betHistory:[] }
};
let currentUser = null;
let matchActive = false;
let matchCounter = Number(localStorage.getItem("kickcoins_matchCounter")) || 0;

/* ----- LOGIN / CREATE ----- */
function saveUsers(){ localStorage.setItem("kickcoins_users",JSON.stringify(users)); }
function saveMatchCounter(){ localStorage.setItem("kickcoins_matchCounter",matchCounter);}
function showLogin(show=true){
    document.getElementById('login-card').style.display=show?'block':'none';
    document.getElementById('app').style.display=!show?'block':'none';
    document.getElementById('logout-btn').style.display=!show?'inline':'none';
}
document.getElementById('login-btn').addEventListener('click',()=>{
    const user = document.getElementById('login-username').value;
    const pass = document.getElementById('login-password').value;
    if(users[user] && users[user].password===pass){
        currentUser=user; showLogin(false); updateUI(); populateVoting(); populatePlayers(); updateLeaderboards(); updateBetHistory();
        alert("Logged in!");
    }else{ alert("Invalid credentials"); }
});
document.getElementById('create-btn').addEventListener('click',()=>{
    const user = document.getElementById('login-username').value;
    const pass = document.getElementById('login-password').value;
    if(users[user]){ alert("User exists"); return; }
    users[user]={password:pass,totalCoins:100,availableCoins:0,votes:{},bets:[],mvpPoints:0,betHistory:[]};
    saveUsers();
    alert("Account created! You can now login.");
});
document.getElementById('logout-btn').addEventListener('click',()=>{
    currentUser=null; showLogin(true);
});

/* ----- TAB NAV ----- */
document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(tc=>tc.style.display='none');
        document.getElementById(tab.dataset.tab+'-tab').style.display='block';
        updateUI();
    });
});

/* ----- ACCOUNT DISPLAY ----- */
function updateUI(){
    if(!currentUser) return;
    let acc = users[currentUser];
    // coin rank with medal
    let coinSorted=Object.entries(users).filter(u=>!u[1].isAdmin).sort((a,b)=>b[1].totalCoins-a[1].totalCoins);
    let rank=coinSorted.findIndex(e=>e[0]===currentUser)+1;
    let medal="ü•á";
    if(rank===2) medal="ü•à"; else if(rank===3) medal="ü•â";
    else if(rank>=4 && rank<=7) medal="ü™®";
    else if(rank>=8) medal="üçÜ";
    let html = `${currentUser} | Total: ${acc.totalCoins} üí∞ | Available: ${acc.availableCoins} üí∏ | Rank: ${rank} <span class="medal">${medal}</span>`;
    document.getElementById('account-info').innerHTML=html;
}

/* ----- MVP VOTING ----- */
function populateVoting(){
    ["vote1","vote2","vote3"].forEach(id=>{
        let sel = document.getElementById(id);
        sel.innerHTML="";
        players.forEach(p=>{
            let opt = document.createElement("option"); opt.value=p; opt.text=p;
            sel.appendChild(opt);
        });
    });
}
document.getElementById('submit-votes').addEventListener('click',()=>{
    if(!matchActive){ alert("Match not started yet."); return; }
    let first=document.getElementById('vote1').value;
    let second=document.getElementById('vote2').value;
    let third=document.getElementById('vote3').value;
    if(new Set([first,second,third]).size<3){ alert("Cannot vote same player multiple times."); return; }
    users[currentUser].votes={"1st":first,"2nd":second,"3rd":third};
    saveUsers();
    alert("Votes submitted!");
    updateLeaderboards();
});

/* ----- BETTING SYSTEM ----- */
function populatePlayers(){
    let sel = document.getElementById('player-select');
    sel.innerHTML="";
    players.forEach(p=>{
        let opt=document.createElement("option"); opt.value=p; opt.text=p;
        sel.appendChild(opt);
    });
    sel.addEventListener('change', populateProps);
}
function populateProps(){
    let container = document.getElementById('props-container');
    container.innerHTML="";
    let player = document.getElementById('player-select').value;
    propsTemplate.forEach(prop=>{
        let card = document.createElement("div"); card.className="prop";
        let label = document.createElement("span"); label.textContent=`${prop} (4x)`; label.className="green";
        let input = document.createElement("input"); input.type="number"; input.min=0; input.max=users[currentUser].availableCoins;
        input.oninput = function(){ 
            if(this.value>users[currentUser].availableCoins) this.value=users[currentUser].availableCoins; 
            updatePayoutPreview();
        }
        card.appendChild(label); card.appendChild(input); container.appendChild(card);
    });
    updatePayoutPreview();
}

/* ----- POTENTIAL PAYOUT ----- */
function updatePayoutPreview(){
    let propsDiv=document.getElementById('props-container').children;
    let total=0;
    for(let p of propsDiv){
        let amt=Number(p.querySelector('input').value);
        let odds=parseFloat(p.querySelector('span').textContent.match(/(\d+)x/)[1]);
        total+=amt*odds;
    }
    document.getElementById('payout-preview').textContent="Potential Payout: "+total;
}

/* ----- SUBMIT BETS ----- */
document.getElementById('submit-bets').addEventListener('click',()=>{
    if(!matchActive){ alert("Match not started yet."); return; }
    let propsDiv=document.getElementById('props-container').children;
    let acc = users[currentUser];
    let matchBets=[];
    for(let p of propsDiv){
        let propName=p.querySelector('span').textContent;
        let amt=Number(p.querySelector('input').value);
        if(amt>0){
            if(acc.availableCoins>=amt){
                acc.availableCoins-=amt;
                let odds=parseFloat(propName.match(/(\d+)x/)[1]);
                let bet={player:document.getElementById('player-select').value,prop:propName,amount:amt,odds:odds,resolved:false,won:false};
                acc.bets.push(bet);
                matchBets.push(bet);
            }else{ alert("Cannot bet more than available balance"); }
        }
    }
    if(matchBets.length>0){
        saveUsers();
        alert("Bets placed!");
        updateUI(); updateBetHistory();
    }
});

/* ----- ADMIN CONTROLS ----- */
function updateAdminUserList(){
    if(!users[currentUser].isAdmin) return;
    let container=document.getElementById('admin-user-list');
    container.innerHTML="";
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            let div=document.createElement("div");
            div.textContent=u;
            let btn=document.createElement("button");
            btn.textContent="Delete"; 
            btn.onclick=function(){
                if(confirm(`Delete user ${u}?`)){
                    delete users[u]; saveUsers(); updateAdminUserList(); updateLeaderboards(); updateBetHistory();
                }
            }
            div.appendChild(btn);
            container.appendChild(div);
        }
    });
}
document.getElementById('start-match').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin){ alert("Only admin"); return; }
    if(matchActive){ alert("Match already started"); return; }
    matchActive=true;
    matchCounter++;
    saveMatchCounter();
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            let acc=users[u];
            let max=Math.min(10, acc.totalCoins);
            acc.availableCoins=max; acc.totalCoins-=max;
        }
    });
    saveUsers();
    alert("Match started!");
});
document.getElementById('end-match').addEventListener('click',()=>{
    if(!currentUser || !users[currentUser].isAdmin){ alert("Only admin"); return; }
    if(!matchActive){ alert("Match not started"); return; }
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            let matchBets = users[u].bets.filter(b=>!b.resolved);
            matchBets.forEach(b=>{
                let res=confirm(`Did ${b.player} succeed in ${b.prop}? (OK=Yes, Cancel=No)`);
                b.resolved=true; b.won=res;
                if(res){ users[u].totalCoins+=b.amount*b.odds; }
            });
            if(matchBets.length>0) users[u].betHistory.push({match:"Match "+matchCounter,bets:matchBets});
            users[u].availableCoins=0;
        }
    });
    matchActive=false; saveUsers(); updateUI(); updateLeaderboards(); updateBetHistory(); alert("Match ended!");
    updateAdminUserList();
});

/* ----- LEADERBOARDS ----- */
function updateLeaderboards(){
    // MVP
    let mvpScores={}; players.forEach(p=>mvpScores[p]=0);
    Object.keys(users).forEach(u=>{
        if(!users[u].isAdmin){
            let v=users[u].votes;
            if(v["1st"]) mvpScores[v["1st"]]+=5;
            if(v["2nd"]) mvpScores[v["2nd"]]+=3;
            if(v["3rd"]) mvpScores[v["3rd"]]+=2;
        }
    });
    let mvpSorted=Object.entries(mvpScores).sort((a,b)=>b[1]-a[1]);
    let tbody=document.getElementById('mvp-leaderboard').querySelector('tbody');
    tbody.innerHTML="";
    mvpSorted.forEach((entry,i)=>{
        let medal="ü•á"; if(i===1) medal="ü•à"; else if(i===2) medal="ü•â";
        else if(i>=3 && i<=6) medal="ü™®"; else if(i>=7) medal="üçÜ";
        let tr=document.createElement("tr");
        tr.innerHTML=`<td>${i+1} <span class="medal">${medal}</span></td><td>${entry[0]}</td><td>${entry[1]}</td>`;
        tbody.appendChild(tr);
    });

    // Coins
    let coinSorted=Object.entries(users).filter(u=>!u[1].isAdmin).sort((a,b)=>b[1].totalCoins-a[1].totalCoins);
    let ct=document.getElementById('coin-leaderboard').querySelector('tbody');
    ct.innerHTML="";
    coinSorted.forEach((entry,i)=>{
        let medal="ü•á"; if(i===1) medal="ü•à"; else if(i===2) medal="ü•â";
        else if(i>=3 && i<=6) medal="ü™®"; else if(i>=7) medal="üçÜ";
        let tr=document.createElement("tr");
        tr.innerHTML=`<td>${i+1} <span class="medal">${medal}</span></td><td>${entry[0]}</td><td>${entry[1].totalCoins}</td>`;
        ct.appendChild(tr);
    });
}

/* ----- BET HISTORY ----- */
function updateBetHistory(){
    if(!currentUser) return;
    let container=document.getElementById('bet-history-container');
    container.innerHTML="";
    let history=users[currentUser].betHistory || [];
    history.forEach(h=>{
        let box=document.createElement("div"); box.className="bet-history-box";
        let header=document.createElement("strong"); header.textContent=h.match; box.appendChild(header);
        h.bets.forEach(b=>{
            let div=document.createElement("div");
            div.innerHTML=`${b.player} - ${b.prop} | Bet: ${b.amount} | ${b.won?"Won":"Lost"} | Payout: ${b.won?b.amount*b.odds:0}`;
            div.style.color=b.won?"#00ff00":"#ff0000";
            box.appendChild(div);
        });
        container.appendChild(box);
    });
}

/* ----- INITIALIZE ----- */
showLogin(true);
updateAdminUserList();
updateLeaderboards();
</script>
</body>
</html>
